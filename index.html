<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<title>Agenda â€“ POC</title>
<style>
  body      { font-family: Arial, sans-serif; padding: 20px; }
  #log      { margin-top: 16px; background:#f5f5f5; padding:12px; border-radius:4px;}
  pre       { background:#eef; padding:12px; border-radius:4px; overflow-x:auto;}
  .ts       { color:#888; font-size:12px; }
</style>
</head>
<body>

<h2>Agenda recebida</h2>
<pre id="resultado">Aguardando dadosâ€¦</pre>

<div id="log"><strong>Log</strong><br></div>

<script>
function ts() { return new Date().toLocaleTimeString(); }
function log(msg){ document.getElementById('log').innerHTML += `<div class="ts">[${ts()}]</div>${msg}<br>`; console.log(msg); }

function exibirAgenda(dados){
  document.getElementById('resultado').textContent =
    JSON.stringify(dados, null, 2);
  log('âœ… Agenda exibida!');
}

/* --------- 1. Evento Customizado --------- */
document.addEventListener('receberAgenda', ev=>{
  log('ðŸ“¨ Evento receberAgenda recebido');
  exibirAgenda(ev.detail?.dados);
});

/* --------- 2. VariÃ¡vel Global (polling) --------- */
setInterval(()=>{
  if (window.dadosAgenda){
    log('ðŸ“¨ dadosAgenda detectado via polling');
    exibirAgenda(window.dadosAgenda.dados);
    window.dadosAgenda = null;          // limpa para nÃ£o repetir
  }
}, 1000);

/* --------- 3. postMessage (caso iframe) --------- */
window.addEventListener('message', ev=>{
  if (ev.data?.tipo === 'exibir_agenda'){
    log('ðŸ“¨ postMessage recebido');
    exibirAgenda(ev.data.dados);
  }
});

/* ---------- FunÃ§Ã£o de teste manual -------- */
window.testeAgenda = () => {
  exibirAgenda({ teste:true, horario:'10:00', status:'ok' });
  log('ðŸ§ª testeAgenda() executado');
};
log('Widget pronto. Execute testeAgenda() no console p/ testar.');
</script>

</body>
</html>
